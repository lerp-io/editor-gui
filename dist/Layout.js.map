{
  "version": 3,
  "file": "Layout.js",
  "sourceRoot": "..",
  "sources": [
    "components/Layout.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "import {createElement,useState,useEffect,useRef} from 'react'\nh = createElement\nimport cn from 'classnames'\nimport LayoutContext from './LayoutContext'\nimport waitForFontLoad from './waitForFontLoad.js'\n\n\nLayout = (props,state)->\n\tlayout_ref = useRef()\n\t[context,setContext] = useState(null)\n\t[win_size,setWinSize] = useState(null)\n\tmeasure_text = useRef(new Map)\n\tcanvas_ref = useRef()\n\t[is_dragging,isDragging] = useState(false)\n\t[force_update_t,forceUpdate] = useState(0)\n\t[font_loaded,setFontLoaded] = useState(null)\n\n\tcss_font = props.fontSize+'px '+props.fontFamily\n\n\tuseEffect ()->\n\t\t# log 'WAIT FOR WEB FONTS',props.waitForWebfonts\n\t\tif props.waitForFontLoad\n\t\t\t# log 'WAIT FOR WEB FONTS',props.fontFamily\n\t\t\twaitForFontLoad(css_font).then ()->\n\t\t\t\t# log 'FONT LOADED'\n\t\t\t\tsetFontLoaded(props.fontFamily)\n\t\treturn\n\t,[props.fontFamily]\n\n\n\tuseEffect ()->\n\t\t# log 'SET MEASURE TEXT CANVAS',font_loaded\n\t\tmeasure_text.current = new Map\n\t\tcan_el = document.createElement(\"canvas\")\n\t\tcanvas_ref.current = can_el.getContext(\"2d\")\n\t\tcanvas_ref.current.font = css_font\n\t\treturn\n\t,[props.fontFamily,props.fontSize,win_size,font_loaded]\n\n\n\tuseEffect ()->\n\t\tview_rect = layout_ref.current.getBoundingClientRect()\n\t\tsetContext\n\t\t\tdepth: 0\n\t\t\tdim: props.fontSize * 1.6\n\t\t\twpad: props.fontSize * .4\n\t\t\troot: yes\n\t\t\tselected_label: 'root'\n\t\t\tview_rect: view_rect\n\t\t\tgetLabelWidth: getLabelWidth\n\t\t\tstopDrag: stopDrag\n\t\t\tfont_loaded: font_loaded\n\t\t\tstartDrag: startDrag\n\n\t,[props.fontFamily,props.fontSize,win_size,font_loaded]\n\n\n\tstartDrag = (onDrag,onDragEnd,onMouseOut)->\n\t\tisDragging(true)\n\t\tlayout_ref.current.addEventListener('mousemove',onDrag)\n\t\tlayout_ref.current.addEventListener('mouseup',onDragEnd)\n\t\tlayout_ref.current.addEventListener('mouseout',onMouseOut)\n\n\tstopDrag = (onDrag,onDragEnd,onMouseOut)->\n\t\tisDragging(false)\n\t\tlayout_ref.current.removeEventListener('mousemove',onDrag)\n\t\tlayout_ref.current.removeEventListener('mouseup',onDragEnd)\n\t\tlayout_ref.current.removeEventListener('mouseout',onMouseOut)\n\t\n\tgetLabelWidth = (label)->\n\t\t\n\t\tctx = canvas_ref.current\n\t\ttext_width = measure_text.current.get(label)\n\t\tif text_width?\n\t\t\t# log 'GET SAVED LABEL WIDTH',text_width\n\t\t\treturn text_width\n\t\telse\n\t\t\t# log 'measure text',props.fontSize,text_width,win_size\n\t\t\ttext_width = ctx.measureText(label).width\n\t\t\tmeasure_text.current.set(label,text_width)\n\t\t\t# log 'GET NEW LABEL WIDTH',text_width\n\t\t\treturn text_width\n\n\n\n\tuseEffect ()->\n\t\tif !context\n\t\t\tonWindowResize = ()->\n\t\t\t\tsetWinSize(window.innerWidth+'-'+window.innerHeight)\n\t\t\tonWindowResize()\n\t\t\twindow.addEventListener 'resize',onWindowResize\n\t\t\treturn\n\t\treturn ()->\n\t\t\twindow.removeEventListener 'resize',onWindowResize\n\t,[]\n\n\th LayoutContext.Provider,\n\t\tvalue: context\n\t\th 'div',\n\t\t\tref: layout_ref\n\t\t\tstyle:\n\t\t\t\tfontSize: props.fontSize\n\t\t\t\tfontFamily: props.fontFamily\n\t\t\tclassName: 'ed-layout '+(is_dragging && 'ed-layout-dragging' || '')\n\t\t\tprops.children\n\nexport default Layout"
  ]
}