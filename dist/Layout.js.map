{
  "version": 3,
  "file": "Layout.js",
  "sourceRoot": "..",
  "sources": [
    "components/Layout.coffee"
  ],
  "names": [],
  "mappings": ";AAAA,IAAA,MAAA,EAAA,aAAA,EAAA;;AAAA,OAAA;EAAQ,aAAR;EAAsB,QAAtB;EAA+B,SAA/B;EAAyC,MAAzC;CAAA,MAAA;;AACA,CAAA,GAAI;;AACJ,OAAO,EAAP,MAAA;;AACA,OAAO,aAAP,MAAA;;AAGA,aAAA,GAAgB,IAAI,GAAJ,CAAA;;AAChB,MAAA,GAAS,QAAA,CAAC,KAAD,EAAO,KAAP,CAAA;AACT,MAAA,YAAA,EAAA,UAAA,EAAA,OAAA,EAAA,WAAA,EAAA,cAAA,EAAA,aAAA,EAAA,UAAA,EAAA,WAAA,EAAA,UAAA,EAAA,YAAA,EAAA,UAAA,EAAA,SAAA,EAAA;EAAC,UAAA,GAAa,MAAA,CAAA;EACb,CAAC,OAAD,EAAS,UAAT,CAAA,GAAuB,QAAA,CAAS,IAAT;EACvB,YAAA,GAAe,MAAA,CAAO,IAAI,GAAJ,CAAA,CAAP;EACf,UAAA,GAAa,MAAA,CAAA;EACb,CAAC,WAAD,EAAa,UAAb,CAAA,GAA2B,QAAA,CAAS,KAAT;EAC3B,CAAC,cAAD,EAAgB,WAAhB,CAAA,GAA+B,QAAA,CAAS,CAAT;EAE/B,SAAA,CAAU,QAAA,CAAA,CAAA;IACT,YAAY,CAAC,OAAb,GAAuB,IAAI,GAAJ,CAAA;EADd,CAAV,EAGC,CAAC,KAAK,CAAC,UAAP,EAAkB,KAAK,CAAC,QAAxB,CAHD;EAKA,YAAA,GAAe,QAAA,CAAA,CAAA;IACd,GAAA,CAAI,cAAJ;WACA,WAAA,CAAY,cAAA,GAAe,CAA3B;EAFc;EAIf,SAAA,GAAY,QAAA,CAAC,MAAD,EAAQ,SAAR,EAAkB,UAAlB,CAAA;IACX,UAAA,CAAW,IAAX;IACA,UAAU,CAAC,OAAO,CAAC,gBAAnB,CAAoC,WAApC,EAAgD,MAAhD;IACA,UAAU,CAAC,OAAO,CAAC,gBAAnB,CAAoC,SAApC,EAA8C,SAA9C;WACA,UAAU,CAAC,OAAO,CAAC,gBAAnB,CAAoC,UAApC,EAA+C,UAA/C;EAJW;EAMZ,QAAA,GAAW,QAAA,CAAC,MAAD,EAAQ,SAAR,EAAkB,UAAlB,CAAA;IACV,UAAA,CAAW,KAAX;IACA,UAAU,CAAC,OAAO,CAAC,mBAAnB,CAAuC,WAAvC,EAAmD,MAAnD;IACA,UAAU,CAAC,OAAO,CAAC,mBAAnB,CAAuC,SAAvC,EAAiD,SAAjD;WACA,UAAU,CAAC,OAAO,CAAC,mBAAnB,CAAuC,UAAvC,EAAkD,UAAlD;EAJU;EAMX,aAAA,GAAgB,QAAA,CAAC,KAAD,CAAA;AACjB,QAAA,MAAA,EAAA,GAAA,EAAA;IACE,IAAG,CAAC,UAAU,CAAC,OAAf;MACC,GAAA,CAAI,+BAAJ;MACA,MAAA,GAAS,QAAQ,CAAC,aAAT,CAAuB,QAAvB;MACT,UAAU,CAAC,OAAX,GAAqB,MAAM,CAAC,UAAP,CAAkB,IAAlB;MACrB,UAAU,CAAC,OAAO,CAAC,IAAnB,GAA0B,KAAK,CAAC,QAAN,GAAe,KAAf,GAAqB,KAAK,CAAC,WAJtD;;IAMA,GAAA,GAAM,UAAU,CAAC;IACjB,UAAA,GAAa,YAAY,CAAC,OAAO,CAAC,GAArB,CAAyB,KAAzB;IACb,IAAG,kBAAH;AACC,aAAO,WADR;KAAA,MAAA;MAGC,UAAA,GAAa,GAAG,CAAC,WAAJ,CAAgB,KAAhB,CAAsB,CAAC;MACpC,YAAY,CAAC,OAAO,CAAC,GAArB,CAAyB,KAAzB,EAA+B,UAA/B;AACA,aAAO,WALR;;EAVe;EAmBhB,SAAA,CAAU,QAAA,CAAA,CAAA;AAEX,QAAA,MAAA,EAAA;IAAE,MAAA,GAAS,QAAQ,CAAC,aAAT,CAAuB,QAAvB;IAET,IAAG,CAAC,OAAJ;MACC,cAAA,GAAiB,QAAA,CAAA,CAAA;AACpB,YAAA;QAAI,SAAA,GAAY,UAAU,CAAC,OAAO,CAAC,qBAAnB,CAAA,EAAhB;;eAEI,UAAA,CACC;UAAA,KAAA,EAAO,CAAP;UACA,GAAA,EAAK,KAAK,CAAC,GAAN,IAAa,EADlB;UAEA,IAAA,EAAM,KAAK,CAAC,IAAN,IAAc,EAFpB;UAGA,WAAA,EAAa,KAAK,CAAC,WAAN,IAAqB,CAHlC;UAIA,IAAA,EAAM,IAJN;UAKA,cAAA,EAAgB,MALhB;UAMA,SAAA,EAAW,SANX;UAOA,aAAA,EAAe,aAPf;UAQA,QAAA,EAAU,QARV;UASA,WAAA,EAAa,YATb;UAUA,SAAA,EAAW;QAVX,CADD;MAHgB;MAejB,cAAA,CAAA;MACA,MAAM,CAAC,gBAAP,CAAwB,QAAxB,EAAiC,cAAjC;AACA,aAlBD;;AAmBA,WAAO,QAAA,CAAA,CAAA;aACN,MAAM,CAAC,mBAAP,CAA2B,QAA3B,EAAoC,cAApC;IADM;EAvBE,CAAV,EAyBC,EAzBD;SA2BA,CAAA,CAAE,aAAa,CAAC,QAAhB,EACC;IAAA,KAAA,EAAO;EAAP,CADD,EAEC,CAAA,CAAE,KAAF,EACC;IAAA,GAAA,EAAK,UAAL;IACA,KAAA,EACC;MAAA,QAAA,EAAU,KAAK,CAAC,QAAhB;MACA,UAAA,EAAY,KAAK,CAAC;IADlB,CAFD;IAIA,SAAA,EAAW,YAAA,GAAa,CAAC,WAAA,IAAe,oBAAf,IAAuC,EAAxC;EAJxB,CADD,EAMC,KAAK,CAAC,QANP,CAFD;AA3EQ;;AAqFT,OAAA,QAAe",
  "sourcesContent": [
    "import {createElement,useState,useEffect,useRef} from 'react'\nh = createElement\nimport cn from 'classnames'\nimport LayoutContext from './LayoutContext'\n\n\n_measure_text = new Map\nLayout = (props,state)->\n\tlayout_ref = useRef()\n\t[context,setContext] = useState(null)\n\tmeasure_text = useRef(new Map)\n\tcanvas_ref = useRef()\n\t[is_dragging,isDragging] = useState(false)\n\t[force_update_t,forceUpdate] = useState(0)\n\n\tuseEffect ()->\n\t\tmeasure_text.current = new Map\n\t\treturn\n\t,[props.fontFamily,props.fontSize]\n\n\t_forceUpdate = ()->\n\t\tlog 'force update'\n\t\tforceUpdate(force_update_t+1)\n\t\n\tstartDrag = (onDrag,onDragEnd,onMouseOut)->\n\t\tisDragging(true)\n\t\tlayout_ref.current.addEventListener('mousemove',onDrag)\n\t\tlayout_ref.current.addEventListener('mouseup',onDragEnd)\n\t\tlayout_ref.current.addEventListener('mouseout',onMouseOut)\n\n\tstopDrag = (onDrag,onDragEnd,onMouseOut)->\n\t\tisDragging(false)\n\t\tlayout_ref.current.removeEventListener('mousemove',onDrag)\n\t\tlayout_ref.current.removeEventListener('mouseup',onDragEnd)\n\t\tlayout_ref.current.removeEventListener('mouseout',onMouseOut)\n\t\n\tgetLabelWidth = (label)->\n\t\t# log 'get label width'\n\t\tif !canvas_ref.current\n\t\t\tlog 'create label width calculator'\n\t\t\tcan_el = document.createElement(\"canvas\")\n\t\t\tcanvas_ref.current = can_el.getContext(\"2d\")\n\t\t\tcanvas_ref.current.font = props.fontSize+'px '+props.fontFamily#\"16px times new roman\"\n\t\t\n\t\tctx = canvas_ref.current\n\t\ttext_width = measure_text.current.get(label)\n\t\tif text_width?\n\t\t\treturn text_width\n\t\telse\n\t\t\ttext_width = ctx.measureText(label).width\n\t\t\tmeasure_text.current.set(label,text_width)\n\t\t\treturn text_width\n\n\n\n\tuseEffect ()->\n\n\t\tcanvas = document.createElement(\"canvas\");\n\t\t\n\t\tif !context\n\t\t\tonWindowResize = ()->\n\t\t\t\tview_rect = layout_ref.current.getBoundingClientRect()\n\t\t\t\t# log view_rect\n\t\t\t\tsetContext\n\t\t\t\t\tdepth: 0\n\t\t\t\t\tdim: props.dim || 24\n\t\t\t\t\twpad: props.wpad || 12\n\t\t\t\t\tpaddingLeft: props.paddingLeft || 4\n\t\t\t\t\troot: yes\n\t\t\t\t\tselected_label: 'root'\n\t\t\t\t\tview_rect: view_rect\n\t\t\t\t\tgetLabelWidth: getLabelWidth\n\t\t\t\t\tstopDrag: stopDrag\n\t\t\t\t\tforceUpdate: _forceUpdate\n\t\t\t\t\tstartDrag: startDrag\n\t\t\tonWindowResize()\n\t\t\twindow.addEventListener 'resize',onWindowResize\n\t\t\treturn\n\t\treturn ()->\n\t\t\twindow.removeEventListener 'resize',onWindowResize\n\t,[]\n\n\th LayoutContext.Provider,\n\t\tvalue: context\n\t\th 'div',\n\t\t\tref: layout_ref\n\t\t\tstyle:\n\t\t\t\tfontSize: props.fontSize\n\t\t\t\tfontFamily: props.fontFamily\n\t\t\tclassName: 'ed-layout '+(is_dragging && 'ed-layout-dragging' || '')\n\t\t\tprops.children\n\nexport default Layout"
  ]
}